<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>

<style type="text/css">
.list-complete li{
  transition: all 0.8s ease;
  display: inline-block;
  margin-right: 10px;
}
</style>
</head>
<body>
<div id="app">
    <h1 style="text-align: center;">Hello Bigcoin</h1><br>
    
    <!--
    <div style="text-align: center;">
        <form action="">
            <input onclick="connect()" value="Connect" type="button">
            <input onclick="send_message()" value="Send" type="button">
            <input id="textID" name="message" value="Hello WebSocket!" type="text"><br>
        </form>
    </div>
    <div id="output"></div>
    -->
    
    <ul>
	  <li v-for="currency in currencyDataList" v-bind:key="currency.ticker">
	  	<div>
    		<span style="color: red;">{{ currency.ticker }}</span>
    		<span style="color: blue;">현재가 {{ currency.closing_price }}</span>
	    </div>
	  </li>
	</ul>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<!-- 개발버전, 도움되는 콘솔 경고를 포함. -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">
var app = new Vue({
	el : '#app',
	data() {
		return {
			currencyDataList : []
		}
	},
	mounted() {
		const wsUri = "http://localhost:8080/websocket";
		const websocket = new SockJS(wsUri);
		
		websocket.onopen = (evt) => {
            console.log('onopen');
        };
        websocket.onmessage = (evt) => {
            var responseData = JSON.parse(evt.data);
            if (Array.isArray(responseData)) {
				this.currencyDataList = responseData;  	
				
            } else {
            	var currency = this.currencyDataList.find(function(currency) {
            		if (currency.ticker === responseData.ticker) {
            			return true;
            		}
            	});
            	this.$set(this.currencyDataList, this.currencyDataList.indexOf(currency), responseData);
            }
        };
        websocket.onerror = (evt) => {
             console.log('onerror : ' + evt.data);
        };
	}
})

/*
// 1. sockjs 미사용
// var wsUri = "ws://localhost:8080/websocket";
// 2. sockjs 사용
var wsUri = "http://localhost:8080/websocket";

var websocket;
var output;
var textID;

function init() {
    output = document.getElementById("output");
    textID = document.getElementById("textID");
}
function connect() {
    if (!websocket) {
    	// 1. sockjs 미사용
        //websocket = new WebSocket(wsUri);
        // 2. sockjs 사용
        websocket = new SockJS(wsUri);
        websocket.onopen = function (evt) {
            onOpen(evt)
        };
        websocket.onmessage = function (evt) {
            onMessage(evt)
        };
        websocket.onerror = function (evt) {
            onError(evt)
        };
    }
}

function disconnect() {
    if (!websocket) websocket.close();
}

function send_message() {
    var message = textID.value;
    writeToScreen("Message Sent: " + message);
    websocket.send(message);
}

function onOpen(evt) {
    writeToScreen("Connected to Endpoint!");
}

function onMessage(evt) {
    writeToScreen("Message Received: " + evt.data);
}

function onError(evt) {
    writeToScreen('ERROR: ' + evt.data);
}

function writeToScreen(message) {
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
}
window.addEventListener("load", init, false);
*/
</script>
</html>